# Часть 4. Сети tcp/ip

---

## Какие из приведённых адресов могут быть использованы в качестве IP-адресов сетевого интерфейса для узлов Интернета? Для синтаксически правильных адресов определите их класс: А, В, С, D или Е.</br> Варианты адресов:</br>а) 123.1.223.5;</br>б) 225.0.0.1;</br>в) 194.87.45.255;</br>г) 10.124.251.252;</br>д) 125.24.255.255;</br>е) 17.213.355.205;</br>ж) 179.12.255.255;</br>з) 127.0.23.55;</br>и) 1.0.0.13;</br>к) 124.1.1.1;</br>л) 192.134.216.255;</br>м) 293.236.254.11;</br>н) 13.13.13.13.

Ответ а), д), и), к), н)

**а) 123.1.223.5**  
Допустимый адрес. Относится к классу A (диапазон: 1.0.0.0–126.255.255.255). Первый октет (123) находится в пределах допустимого
для класса A.

**д) 125.24.255.255**  
Допустимый адрес. Также относится к классу A, так как первый октет (125) входит в диапазон 1–126.

**и) 1.0.0.13**  
Допустимый адрес. Класс A. Первый октет (1) находится в допустимом диапазоне.

**к) 124.1.1.1**  
Допустимый адрес. Класс A. Первый октет (124) входит в диапазон 1–126.

**н) 13.13.13.13**  
Допустимый адрес. Класс A. Первый октет (13) находится в допустимом диапазоне.

### Почему другие варианты не подходят
**б) 225.0.0.1**  
Недопустим для обычных сетевых интерфейсов. Относится к классу D (224.0.0.0–239.255.255.255), который зарезервирован для
многоадресной рассылки (multicast).

**в) 194.87.45.255**  
Недопустим. Относится к классу C (192.0.0.0–223.255.255.255), но последний октет (255) является широковещательным адресом
для сети, и его нельзя присвоить узлу.

**г) 10.124.251.252**  
Недопустим для Интернета. Это частный адрес из диапазона класса A (10.0.0.0/8), используемый в локальных сетях.

**е) 17.213.355.205**  
Недопустим. Третий октет (355) выходит за диапазон 0–255, что нарушает правила записи IP-адресов.

**ж) 179.12.255.255**  
Недопустим. Относится к классу B (128.0.0.0–191.255.255.255), но последний октет (255) является широковещательным адресом
для сети.

**з) 127.0.23.55**  
Недопустим для Интернета. Диапазон 127.0.0.0/8 зарезервирован для loopback (локальной отладки).

**л) 192.134.216.255**  
Недопустим. Относится к классу C (192.0.0.0–223.255.255.255), но последний октет (255) является широковещательным адресом
для сети.

**м) 293.236.254.11**  
Недопустим. Первый октет (293) выходит за допустимые пределы для всех классов IPv4 (максимум — 255).

---

## 2. Пусть IP-адрес некоторого узла подсети равен 108.5.18.167, а значение маски для этой подсети — 255.255.255.240. Определите номер подсети. Какое максимальное число сетевых интерфейсов может быть в этой подсети?

### 1. Определение номера подсети
Чтобы найти номер подсети, нужно выполнить **побитовое И** между IP‑адресом и маской.
**Дано:**
- IP‑адрес: `108.5.18.167`
- Маска: `255.255.255.240`

**Шаг 1.** Переведём последний октет в двоичный вид:
- IP (`167`): `10100111`
- Маска (`240`): `11110000`

**Шаг 2.** Выполним побитовое И:
```
  10100111 (167)
& 11110000 (240)
  ────────
  10100000 (160)
```

**Шаг 3.** Собираем полный адрес подсети:
- Первые три октета совпадают (маска `255` → берём как есть).
- Последний октет: `160`.

**Номер подсети:** `108.5.18.160`

### 2. Максимальное число сетевых интерфейсов
**Шаг 1.** Определим количество бит для хостов. 

Маска `255.255.255.240` в двоичном виде: `11111111.11111111.11111111.11110000` → **4 бита** отведены под хосты (нули в маске).

**Шаг 2.** Вычислим количество адресов.

2^4 = 16 адресов.

**Шаг 3.** Учтем ограничения:
- Один адрес — номер подсети (`108.5.18.160`). Это адрес, где все биты хостовой части — нули. Последний октет: 10100000 в двоичном
- Один адрес — широковещательный (`108.5.18.175`). Это адрес, где все биты хостовой части — единицы. Последний октет: 10101111 в двоичном.

**Итого доступных интерфейсов:**

Всего адресов в подсети: 16.

Нельзя использовать:
- 1 адрес (номер подсети),
- 1 адрес (широковещательный).

16 - 2 = 14.

---

## 3. Какое максимальное количество подсетей теоретически можно организовать, если в вашем распоряжении имеется сеть класса С? Какое значение должна при этом иметь маска? При ответе не принимайте во внимание двухточечные соединения.

Ответ:
- **Максимальное число подсетей:** 64.
- **Требуемая маска:** `255.255.255.252` (или `/30` в CIDR‑нотации).

**Что такое сеть класса C?**
- Диапазон: от `192.0.0.0` до `223.255.255.255`.
- Стандартная маска: `255.255.255.0` (`/24`), то есть:
    - **24 бита** — сетевая часть (фиксирована);
    - **8 бит** — хостовая часть (можно «забирать» под подсеть).

**Как делить на подсети?**
- Чтобы создать подсети, «забираем» биты из хостовой части и отдаём их под номер подсети.
- В классе C у нас **8 бит** для хостов. Чтобы в каждой подсети было хотя бы **2 адреса для устройств**, нужно оставить
минимум **2 бита на хосты** (тогда 2^2 - 2 = 2 полезных адреса).
- Значит, под номер подсети можно отдать **6 бит** (8 - 2 = 6).

**Почему максимум 64 подсети?**
- Если взять **6 бит** под номер подсети:
    - Число подсетей: 2^6 = 64.
    - Остаётся **2 бита** на хосты: 2^2 - 2 = 2 адреса на подсеть (минус номер сети и broadcast).
- Взять 7 бит под подсети нельзя: останется 1 бит на хосты → 2^1 - 2 = 0 адресов (бесполезно).


**Какая маска?**
- Было: `/24` (24 бита сети).
- Добавляем 6 бит под подсети: 24 + 6 = 30 бит сети.
- Маска: `255.255.255.252` (`/30`).
- Проверка:
    - Последний октет маски (`252`) в двоичном виде: `11111100` → 6 единиц (добавили 6 бит к сети) и 2 нуля (осталось на хосты).

**Почему не `/26`?**
- При `/26` мы «забираем» только 2 бита из хостовой части (26 - 24 = 2).
- Тогда:
    - Подсетей: 2^2 = 4 (намного меньше 64).
    - Хостов на подсеть: 2^6 - 2 = 62 (много, но число подсетей мало).
- `/30` даёт максимум подсетей при минимуме хостов.

---

## 4. Пусть вам ничего не известно об узлах, кроме их DNS-имен:</br> w1.piter.ru, www.msk.ru и www.piter.ru, echo.msk.ru.</br> Что вы можете сказать о том, насколько близко территориально находятся они относительно друг друга?</br> Варианты ответов:</br> а) узел www.msk.ru территориально ближе к echo.msk.ru, чем к w1.piter.ru;</br> б) узел www.msk.ru расположен ближе к www.piter.ru, чем к echo.msk.ru;</br> в) узел w1.piter.ru территориально ближе к www.piter.ru, чем к www.msk.ru;</br> г) ничего определённого.

Ответ г)

DNS‑имя (например, `www.msk.ru` или `w1.piter.ru`) **не содержит информации о физическом местоположении узла**.

- `msk.ru` — намекает на Москву (`msk` = Москва).
- `piter.ru` — намекает на Санкт‑Петербург (`piter` = Питер).

Но это **только семантика** (смысловая подсказка для человека), а не технический параметр.

**Серверы могут быть размещены где угодно**
- Домен `msk.ru` может физически находиться:
    - в Москве,
    - в другом городе России,
    - даже за границей (например, на хостинге в Германии).
- То же самое с `piter.ru`.

**DNS не привязан к географии**
- DNS‑имя — это просто «удобное имя» для IP‑адреса.
- IP‑адрес тоже **не гарантирует** местоположение (из‑за VPN, прокси, CDN, облачных сервисов).

**Примеры обмана ожиданий**
- Сайт `example.msk.ru` может работать на сервере в Сибири.
- Два сайта с `piter.ru` могут находиться в разных странах, если их хостят международные провайдеры.

---

## 5. Пусть вам ничего не известно о структуре сети, но в вашем распоряжении имеется следующая таблица соответствия IP-адресов и DNS-имен нескольких узлов сети:

| IP-адрес узла | 123.1.0.01 | 123.1.0.02 | 123.1.0.03 | 123.1.0.04 | ? | ? |
| --- | --- | --- | --- | --- | --- | --- |
| DNS-имя узла | w1.mgu.ru | w2.mgu.ru | w3.mgu.ru | w4.mgu.ru | w5.mgu.ru | w6.mgu.ru |

### Что вы можете сказать об IP-адресах узлов, имеющих DNS-имена w5.mgu.ru и w6.mgu.ru?

Между DNS-именами и IP-адресами в общем случае нет связи, поэтому ничего определенного сказать нельзя.

**Что видно из таблицы**
- Все известные узлы (`w1`–`w4`) имеют IP‑адреса в формате `123.1.0.XX`, где `XX`—порядковый номер (`01`, `02`, `03`, `04`).
- Все DNS‑имена принадлежат домену `mgu.ru` и следуют шаблону `w<номер>.mgu.ru`.

**Логичное предположение**
- Если нумерация IP‑адресов последовательная, то:
    - `w5.mgu.ru` → скорее всего, `123.1.0.05`;
    - `w6.mgu.ru` → скорее всего, `123.1.0.06`.
- Это соответствует шаблону: `123.1.0.<номер_узла>`.

**Почему нельзя утверждать наверняка**
- В таблице есть **пропуски** (знаки `?`), значит:
    - Возможно, адреса назначаются не строго по порядку (например, `w5` может иметь `123.1.0.10`).
    - Могут быть зарезервированные адреса или иная логика распределения.
- Нет информации о **маске подсети** или правилах адресации в этой сети.

**Что точно известно**
- Узлы `w5` и `w6` принадлежат той же сети (`123.1.0.0/24`), что и `w1`–`w4`, так как:
    - Первые три октета (`123.1.0`) совпадают.
    - DNS‑имена в одном домене (`mgu.ru`), что обычно указывает на единую инфраструктуру.

---

## 6. Какая запись из следующих эквивалентна значению маски /29</br> (выберите вариант ответа):</br> а) 255.255.2.9;</br> б) 255.255.255.29;</br> в) 255.255.255.248;</br> г) 255.255.255.229.

Ответ в)

Маска `/29` означает, что в двоичном представлении маски **29 первых битов — единицы**, а остальные (32 − 29 = 3) — нули.

**Переводим `/29` в двоичный вид:**
- 29 единиц: `11111111 11111111 11111111 11111000` (разбили на октеты для наглядности).
- Последние 3 бита — нули.

**Разбиваем на октеты и переводим в десятичный вид:**
- Первый октет: `11111111` = 255.
- Второй октет: `11111111` = 255.
- Третий октет: `11111111` = 255.
- Четвёртый октет: `11111000` = 248 (так как 128 + 64 + 32 + 16 + 8 = 248). Как это работает:</br>
  Разберём, почему двоичное число `11111000` равно **248** в десятичной системе.</br>
  В двоичной системе каждая позиция (бит) — это степень двойки, начиная **справа** (от младшего бита). Значение бита (`0` или `1`)
  показывает, *берём* ли мы эту степень в сумму.
  ### Шаг 1. Пронумеруем биты справа налево (начиная с 0)
  ```
  1  1  1  1  1  0  0  0
  ↑  ↑  ↑  ↑  ↑  ↑  ↑  ↑
  7  6  5  4  3  2  1  0
  ```
    - Позиция 0 (самый правый бит) → 2^0 = 1
    - Позиция 1 → 2^1 = 2
    - Позиция 2 → 2^2 = 4
    - ...
    - Позиция 7 (самый левый бит) → 2^7 = 128
  ### Шаг 2. Смотрим, где стоят единицы
  В числе `11111000` единицы — на позициях **7, 6, 5, 4, 3** (слева направо).  </br>
  Значит, берём соответствующие степени двойки:</br>
    - 2^7 = 128
    - 2^6 = 64
    - 2^5 = 32
    - 2^4 = 16
    - 2^3 = 8
  ### Шаг 3. Складываем
  128 + 64 + 32 + 16 + 8 = 248
  ### Почему нули не учитываем?
  Нули означают: «эту степень двойки **не берём**». В нашем случае нули на позициях **2, 1, 0**, поэтому:
    - 2^2 = 4 → не берём,
    - 2^1 = 2 → не берём,
    - 2^0 = 1 → не берём.
  ### Итог
  `11111000₂ = 248₁₀`, потому что:</br>
  128\ (2^7) + 64\ (2^6) + 32\ (2^5) + 16\ (2^4) + 8\ (2^3) = 248.

**Получаем маску:** `255.255.255.248`.


### Почему не другие варианты?
- **а) 255.255.2.9** — явно неверно: октеты `2` и `9` не соответствуют шаблону маски (должны быть либо 255, либо число с
«границей» из единиц и нулей).
- **б) 255.255.255.29** — неверно: `29` в последнем октете (`00011101` в двоичном) не даёт 29 единичных битов в маске.
- **г) 255.255.255.229** — неверно: `229` (`11100101` в двоичном) тоже не соответствует 29 единицам подряд.

---

## 7. Могут ли для двухточечной связи быть назначены адреса 197.220.12.9/31 и 197.220.12.10/31?

Ответ: Да, адреса `197.220.12.9/31` и `197.220.12.10/31` **могут быть назначены** для двухточечной (point‑to‑point) связи.

**Что значит `/31`?**
- Маска `/31` означает, что в IP‑адресе **31 бит отведён под сеть**, а **1 бит — под хосты**.
- В двоичном виде маска: `11111111.11111111.11111111.11111110` (31 единица + 1 ноль).
- Это даёт **всего 2 комбинации** для хостов:
  - `...0` (ноль в последнем бите),
  - `...1` (единица в последнем бите).

**Как это работает для двух устройств**
- В двухточечном соединении **ровно два узла** (например, два маршрутизатора, соединённых кабелем).
- Им достаточно **двух адресов**, что идеально ложится на схему `/31`:
  - Узел 1: `197.220.12.9` → в двоичном последний бит `1` (`...1001`).
  - Узел 2: `197.220.12.10` → в двоичном последний бит `0` (`...1010`).

**Почему это разрешено?**
- Стандарт **RFC 3021** («Using 31‑Bit Prefixes on IPv4 Point‑to‑Point Links») специально разрешает использовать `/31` для двухточечных связей.
- Обычно в подсети «забирают» 2 адреса:
  - один — на адрес сети (все нули в хостовой части),
  - один — на широковещательный адрес (все единицы в хостовой части).
- Но в `/31` это **не нужно**:
  - Два оставшихся адреса напрямую назначаются двум узлам.
  - Широковещательные рассылки не требуются (связь точка‑точка).
- Это экономит адреса: вместо `/30` (4 адреса, из них 2 полезных) используется `/31` (2 адреса, оба полезных).

**Проверка на примере**
- Сеть: `197.220.12.8/31` (адрес сети определяется по маске).
- Доступные хосты:
  - `197.220.12.9` (последний бит `1`),
  - `197.220.12.10` (последний бит `0`).
- Нет «потерянных» адресов на сеть/broadcast — оба адреса используются.

---

## 8. Содержимое ARP-таблицы изменяется в результате следующих событий</br> (выберите вариант ответа):</br> а) при получении ARP-ответов на запрос;</br> б) при получении широковещательных ARP-запросов;</br> в) по истечении времени жизни записи в ARP-таблице.

Ответ а), б), в)

**ARP‑таблица** — это «телефонная книжка» устройства в сети, где хранятся **пары «IP‑адрес → MAC‑адрес»** известных ему соседей.

### Зачем нужна
Чтобы устройство могло отправлять данные другому устройству в локальной сети, оно должно знать:
- **IP‑адрес получателя** (логический адрес, как номер телефона);
- **MAC‑адрес получателя** (физический адрес сетевой карты, как имя абонента).

ARP‑таблица связывает эти два адреса. Без неё каждое отправление пакета требовало бы нового запроса «кто имеет этот IP?».

### Что хранится в таблице
- **IP‑адрес** устройства‑соседа;
- **MAC‑адрес** этого устройства;
- **интерфейс**, через который оно доступно;
- **таймер жизни** записи (когда её нужно удалить).

### Как заполняется
**Автоматически** — через ARP‑запросы и ответы:
- Устройство спрашивает: «Кто имеет IP 192.168.1.100? Ответь!» (ARP‑запрос).
- Устройство с этим IP отвечает: «Это я, мой MAC — AA:BB:CC:DD:EE:FF» (ARP‑ответ).
- Отправитель добавляет пару `(192.168.1.100 → AA:BB:CC:DD:EE:FF)` в свою ARP‑таблицу.
- 
**При анализе чужих запросов** — если устройство видит ARP‑запрос от соседа, оно может запомнить его IP и MAC, даже если запрос не к нему.

**Вручную** — администратор может добавить статические записи (они не истекают).

### Как обновляется и очищается
- **Обновление:** при получении нового ARP‑ответа или при повторном обнаружении устройства таймер жизни записи сбрасывается.
- **Удаление:** по истечении таймера запись исчезает (чтобы не хранить устаревшие данные).

### Пример таблицы
```
IP‑адрес         | MAC‑адрес           | Интерфейс | Время до удаления
192.168.1.100  | AA:BB:CC:DD:EE:FF | eth0    | 120 сек
192.168.1.101  | 11:22:33:44:55:66 | eth0    | 90 сек
```

**а) При получении ARP‑ответов на запрос**
- Когда устройство отправляет **ARP‑запрос** («Кто имеет IP‑адрес X.X.X.X? Ответь!»), оно ждёт ответа.
- Получив **ARP‑ответ** («Я имею IP‑адрес X.X.X.X, мой MAC‑адрес — AA:BB:CC:DD:EE:FF»), устройство:
  - добавляет пару «IP‑адрес → MAC‑адрес» в свою ARP‑таблицу;
  - обновляет время жизни (TTL) этой записи.
- **Итог:** таблица пополняется или обновляется.

**б) При получении широковещательных ARP‑запросов**
- Если устройство получает **широковещательный ARP‑запрос** (например, «Кто имеет IP 192.168.1.100? Ответь!»), оно:
  - проверяет, относится ли запрос к его собственному IP‑адресу;
  - если да — отправляет ARP‑ответ;
  - **но даже если нет** — анализирует исходный IP‑ и MAC‑адрес отправителя запроса и **добавляет их в свою ARP‑таблицу** (предварительно).
- **Зачем:** чтобы не тратить время на новый ARP‑запрос, если вскоре понадобится связаться с этим устройством.
- **Итог:** таблица может пополниться записью о другом устройстве без явного запроса.

**в) По истечении времени жизни записи в ARP‑таблице**
- Каждая запись в ARP‑таблице имеет **таймер жизни** (TTL, обычно от нескольких минут до часов).
- Когда таймер истекает, запись:
  - автоматически удаляется из таблицы;
  - считается устаревшей.
- **Зачем:** чтобы таблица не разрасталась бесконечно и не хранила неактуальные данные (например, если устройство отключилось
или сменило MAC‑адрес).
- **Итог:** таблица очищается от устаревших записей.

---

## 9. Протокол ARP функционально можно разделить на клиентскую и серверную части. Опишите, какие функции вы отнесли бы к клиентской части, а какие — к серверной?

**Клиентская часть** (инициатор запроса):
- **Отправляет ARP‑запрос** («Кто имеет IP‑адрес X.X.X.X? Ответьте!») в локальную сеть (широковещательно).
- **Ожидает ARP‑ответ** от устройства с нужным IP.
- **Обновляет свою ARP‑таблицу** при получении ответа (добавляет пару «IP → MAC»).
- **Использует MAC‑адрес** из ответа для отправки кадров на целевое устройство.

*Когда срабатывает:* когда устройству нужно отправить данные в локальной сети, но в его ARP‑таблице нет MAC‑адреса получателя.


**Серверная часть** (ответчик):
- **Принимает ARP‑запросы**, адресованные её IP‑адресу.
- **Формирует и отправляет ARP‑ответ** («Это я! Мой MAC‑адрес — AA:BB:CC:DD:EE:FF»).
- **Может «предварительно заполнять» свою ARP‑таблицу**, анализируя IP‑ и MAC‑адреса отправителя запроса (даже если запрос не к ней).

*Когда срабатывает:* при получении ARP‑запроса, где указан IP‑адрес этого устройства.


### Простой пример
1. **Клиент** (устройство A, IP 192.168.1.10):
  - Нужно отправить пакет на 192.168.1.20, но MAC‑адрес неизвестен.
  - Отправляет широковещательный ARP‑запрос: «Кто 192.168.1.20? Ответьте!».
2. **Сервер** (устройство B, IP 192.168.1.20):
  - Получает запрос, видит, что он к её IP.
  - Отправляет ARP‑ответ: «Я 192.168.1.20, мой MAC — 00:11:22:33:44:55».
3. **Клиент** (устройство A):
  - Получает ответ, добавляет в ARP‑таблицу: `192.168.1.20 → 00:11:22:33:44:55`.
  - Теперь может отправлять кадры на устройство B.

---

## 10. В чём состоят функции нижнего уровня стека ТСР/IP</br> (выберите вариант ответа):</br> а) кодирование и мультиплексирование электрических сигналов;</br> б) инкапсуляция и декапсуляция данных сетевого уровня в кадры нижележащей технологии;</br> в) формирование кадров и синхронизация;</br> г) доступ к среде передачи;</br> д) преобразование сетевых адресов в адреса нижележащей технологии.

Ответ б), д)

**б) Инкапсуляция и декапсуляция данных сетевого уровня в кадры нижележащей технологии**
- Нижний уровень (канальный, *Link Layer*) берёт **пакет IP** (данные сетевого уровня) и «упаковывает» его в **кадр** 
той технологии, по которой идёт передача (Ethernet, Wi‑Fi, PPP и т.п.).
- При приёме — наоборот: снимает кадр, извлекает IP‑пакет и передаёт его вверх по стеку.
- Это и есть инкапсуляция (вложение) и декапсуляция (распаковка).

**д) Преобразование сетевых адресов в адреса нижележащей технологии**
- IP‑адреса (сетевой уровень) нужно сопоставить с **физическими MAC‑адресами** (канальный уровень).
- За это отвечает **ARP** (для IPv4): по IP находит MAC и формирует кадр с корректными MAC‑адресами получателя и отправителя.
- Для IPv6 аналогичную роль играет NDP.

#### Почему не а), в), г)
**а) Кодирование и мультиплексирование электрических сигналов**
- Это задачи **физического уровня** (например, модуляция, битовое кодирование, синхронизация сигналов).
- В модели TCP/IP «нижний уровень» обычно понимают как **канальный** (а не физический), поэтому этот пункт не относится.

**в) Формирование кадров и синхронизация**
- «Формирование кадров» частично входит в инкапсуляцию, но «синхронизация» — это опять‑таки физический уровень 
(битовая синхронизация, тактование).
- В контексте TCP/IP нижний уровень не занимается низкоуровневой синхронизацией сигналов — это вне его зоны ответственности.

**г) Доступ к среде передачи**
- Механизмы доступа к среде (CSMA/CD, CSMA/CA, TDMA и т. п.) действительно работают на канальном уровне.
- Однако в формулировке вопроса акцент на **функциях именно стека TCP/IP**, а не на общих функциях канального уровня.
- В TCP/IP доступ к среде обычно «делегирован» нижележащим технологиям (Ethernet, Wi‑Fi и т.п.), а не реализуется самим 
стеком TCP/IP. Поэтому этот пункт менее точен в данном контексте.

---